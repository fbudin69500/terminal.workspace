# The following variables can be defined in a
# `.workspace.config` file for environment-variables workspace:

# * `workspace_env_var`: This variable defines the list of
# environment variables that are automatically set when working in
# the current workspace.

# This variable should be defined as `local` variables to avoid
# polluting the environment.

# IMPORTANT: If you append values to an existing environment variable,
# make sure that your expression does not evaluate when the `.workspace.config`
# file is loaded, but only when the expression is evaluated. This means that
# if the expression contains a `$`, you need to escape it with `\` or write the
# expression between simple quotes, not double quotes!!!
#
# e.g. workspace_env_var=("PATH=~/bin:\$PATH")
#
# or
#
# e.g. workspace_env_var=('PATH=~/bin:$PATH')

function env_var_activate_workspace {
        if [[ -n "$workspace_env_var" ]]; then
            for _expr in ${workspace_env_var[@]}; do
                var_name=$(echo $_expr |sed 's/=.*//')
                #Save old value
                #TODO: Handle case where ${var_name}_OLD already exists. Error Message?
                if [[ -n "$var_name" ]]; then
                    eval $( echo ${var_name}_OLD=\$$var_name )
                fi
                # replace by new value
                eval export $( echo $_expr )
            done
        fi
}

function env_var_deactivate_workspace {
    if [[ -n "$workspace_env_var" ]]; then
        for _expr in ${workspace_env_var[@]}; do
            var_name=$(echo $_expr |sed 's/=.*//')
            #unset $var_name
            #var_name=$( echo $_expr | sed -n 's;\([^=]*\)=.*;\1;p')
            #Load old value
            if [[ -n "$var_name" ]]; then
                eval export $( echo ${var_name}=\$${var_name}_OLD )
            fi
            unset ${var_name}_OLD
            # TODO: Need to unset ${var_name} if it did not exist originally
        done
    fi
}
